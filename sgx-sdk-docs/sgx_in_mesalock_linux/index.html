<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-teaclave-sgx-sdk/documents/sgx_in_mesalock_linux" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Run Rust SGX Applications in Mesalock Linux | Apache Teaclave (incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://teaclave.apache.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://teaclave.apache.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://teaclave.apache.org/sgx-sdk-docs/sgx_in_mesalock_linux"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Run Rust SGX Applications in Mesalock Linux | Apache Teaclave (incubating)"><meta data-rh="true" name="description" content="MesaLock Linux is a general purpose Linux distribution which aims to provide a safe and secure user space environment. To eliminate high-severe vulnerabilities caused by memory corruption, the whole user space applications are rewritten in memory-safe programming languages like Rust and Go. This extremely reduces attack surfaces of an operating system exposed in the wild, leaving the remaining attack surfaces auditable and restricted.  Therefore, MesaLock Linux can substantially improve the security of the Linux ecosystem. Additionally, thanks to the Linux kernel, MesaLock Linux supports a broad hardware environment, making it deployable in many places. Two main usage scenarios of MesaLock Linux are for containers and security-sensitive embedded devices. With the growth of the ecosystem, MesaLock Linux would also be adopted in the server environment in the future."><meta data-rh="true" property="og:description" content="MesaLock Linux is a general purpose Linux distribution which aims to provide a safe and secure user space environment. To eliminate high-severe vulnerabilities caused by memory corruption, the whole user space applications are rewritten in memory-safe programming languages like Rust and Go. This extremely reduces attack surfaces of an operating system exposed in the wild, leaving the remaining attack surfaces auditable and restricted.  Therefore, MesaLock Linux can substantially improve the security of the Linux ecosystem. Additionally, thanks to the Linux kernel, MesaLock Linux supports a broad hardware environment, making it deployable in many places. Two main usage scenarios of MesaLock Linux are for containers and security-sensitive embedded devices. With the growth of the ecosystem, MesaLock Linux would also be adopted in the server environment in the future."><link data-rh="true" rel="canonical" href="https://teaclave.apache.org/sgx-sdk-docs/sgx_in_mesalock_linux"><link data-rh="true" rel="alternate" href="https://teaclave.apache.org/sgx-sdk-docs/sgx_in_mesalock_linux" hreflang="en"><link data-rh="true" rel="alternate" href="https://teaclave.apache.org/sgx-sdk-docs/sgx_in_mesalock_linux" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Rust SGX Applications in Mesalock Linux","item":"https://teaclave.apache.org/sgx-sdk-docs/sgx_in_mesalock_linux"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Teaclave (incubating) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Teaclave (incubating) Atom Feed"><link rel="stylesheet" href="/assets/css/styles.c864e24f.css">
<script src="/assets/js/runtime~main.af65d8d3.js" defer="defer"></script>
<script src="/assets/js/main.fd7e90dd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Apache Teaclave" class="themedComponent_DHUr themedComponent--light_DIHH" style="height:5.6rem;padding-left:1.6rem;position:relative;top:-1.8rem"><img src="/img/logo.svg" alt="Apache Teaclave" class="themedComponent_DHUr themedComponent--dark_Bv2M" style="height:5.6rem;padding-left:1.6rem;position:relative;top:-1.8rem"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/powered-by">Powered By</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/community">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contributing">Contributing</a></li><li><a class="dropdown__link" href="/contributors">Contributors</a></li></ul></div><a class="navbar__item navbar__link" href="/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/">Teaclave</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/sgx-sdk-docs/">Teaclave SGX SDK</a></li><li><a class="dropdown__link" href="/trustzone-sdk-docs/">Teaclave TrustZone SDK</a></li><li><a href="https://teaclave.apache.org/api-docs/sgx-sdk/" target="_self" rel="" class="dropdown__link">Teaclave SGX SDK<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://teaclave.apache.org/api-docs/trustzone-sdk/optee-teec" target="_self" rel="" class="dropdown__link">Teaclave TrustZone SDK (Host)<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://teaclave.apache.org/api-docs/trustzone-sdk/optee-utee" target="_self" rel="" class="dropdown__link">Teaclave TrustZone SDK (TA)<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Repos</a><ul class="dropdown__menu"><li><a href="https://github.com/apache/incubator-teaclave" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/apache/incubator-teaclave-sgx-sdk" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave SGX SDK<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/apache/incubator-teaclave-trustzone-sdk" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave TrustZone SDK<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/apache/incubator-teaclave-java-tee-sdk" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave Java TEE SDK<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/apache/incubator-teaclave-website" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave Website<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">ASF Homepage<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ systemToggleIcon_txm5"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_bmvg"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_UyTV"><div class="docsWrapper_XLvK"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docRoot_HciC"><aside class="theme-doc-sidebar-container docSidebarContainer_e5ai"><div class="sidebarViewport_N8x0"><div class="sidebar_vJCc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/sgx-sdk-docs/environment-setup">Development</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/environment-setup">Setting up your Development Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/sgx-sdk-docs/sgx_in_mesalock_linux">Rust SGX Applications in Mesalock Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/is_x86_feature_detected-in-sgx-sdk">`is_x86_feature_detected` in Teaclave SGX SDK</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/developing-with-vscode">Developing with Visual Studio Code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/debugging-a-local-rust-sgx-enclave">Debugging a Local Enclave in Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/public-cloud-for-rust-sgx-dev">Public Cloud Rust SGX Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/the-world-of-forked-crates">The World of Forked Crates</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sgx-sdk-docs/sgxtime">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/sgx-sdk-docs/everything-about-cve-2020-5499">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a href="https://www.ieee-security.org/TC/SP2019/posters/hotcrp_sp19posters-final11.pdf" target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false">Applications</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_namt"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Development</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Rust SGX Applications in Mesalock Linux</span></li></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Run Rust SGX Applications in Mesalock Linux</h1></header>
<p>MesaLock Linux is a general purpose Linux distribution which aims to provide a safe and secure user space environment. To eliminate high-severe vulnerabilities caused by memory corruption, the whole user space applications are rewritten in memory-safe programming languages like Rust and Go. This extremely reduces attack surfaces of an operating system exposed in the wild, leaving the remaining attack surfaces auditable and restricted.  Therefore, MesaLock Linux can substantially improve the security of the Linux ecosystem. Additionally, thanks to the Linux kernel, MesaLock Linux supports a broad hardware environment, making it deployable in many places. Two main usage scenarios of MesaLock Linux are for containers and security-sensitive embedded devices. With the growth of the ecosystem, MesaLock Linux would also be adopted in the server environment in the future.</p>
<p>We believe that running Rust SGX applications inside Mesalock Linux could improve the security of SGX applications and reduce their attack surface significantly.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="is-it-safe-to-run-rust-sgx-applications-in-mesalock-linux">Is it safe to run Rust SGX applications in Mesalock Linux?<a href="#is-it-safe-to-run-rust-sgx-applications-in-mesalock-linux" class="hash-link" aria-label="Direct link to Is it safe to run Rust SGX applications in Mesalock Linux?" title="Direct link to Is it safe to run Rust SGX applications in Mesalock Linux?">​</a></h2>
<p>A typical Rust SGX application has at least to components: one enclave, and one untrusted component. The enclave is self-contained and doesn&#x27;t need dynamic loading. The untrusted component depends on <code>liburts</code> (untrusted runtime service library), which depends on the Application Enclave Services Manager library.</p>
<p>We show the dependency tree as follows. In this tree, we hide all the dynamic libraries which already exist in Mesalock Linux.</p>
<div class="language-bash codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-bash codeBlock_TAPP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">SGX Application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Enclave (statically linked)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── Untrusted component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── SGX untrusted runtime (libsgx_urts.so)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── libstdc++ (libstdc++.so.6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── AESM service library (libsgx_uae_service.so)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └── libprotobuf (libprotobuf.so.9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ├── libstdc++ (libstdc++.so.6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                └── zlib (libz.so.1)    </span><br></span></code></pre></div></div>
<p>We can see that, to support Rust SGX applications in Mesalock Linux, the minimum set of required shared library is : libsgx_urts.so, libsgx_uae_service.so, libstdc++.so.6, libz.so.1 and libprotobuf.so.9.</p>
<p>We refined the rules-of-thumb for hybrid memory-safe architecture designing and here is the refined version.</p>
<ol>
<li>Unsafe components must not taint safe components, especially for public APIs and data structures.</li>
<li>Unsafe components should be as small as possible and decoupled from safe components.</li>
<li>Unsafe components should be explicitly marked during deployment and ready to upgrade.</li>
</ol>
<p>Hence, we believe that running Rust SGX applications in Mesalock Linux could provide better security guarantees if they follow the memory safety principles.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="solution-overview">Solution Overview<a href="#solution-overview" class="hash-link" aria-label="Direct link to Solution Overview" title="Direct link to Solution Overview">​</a></h2>
<p>The whole solution contains two steps:</p>
<ol>
<li>Build Rust SGX applications in dev environment, such as Rust SGX docker container.</li>
<li>Run Rust SGX application in Mesalock Linux docker container.</li>
</ol>
<p>Step 1 is trivial.</p>
<p>For step 2, the Intel AESM service is required. Technically, Intel AESM service listens at a domain socket <code>/var/run/aesmd/aesm.socket</code> and provide service via this domain socket. To interact with CPU, Intel AESM service needs to access <code>/dev/isgx</code>.</p>
<p>There are two options for running the aesm service: (1) start <code>aesmd</code> inside the Mesalock Linux container, or (2) start <code>aesmd</code> on the host OS and provide service to the SGX application inside the container. The first method provides better isolation for <code>aesmd</code>, but it would start a set of infrastructure enclaves for each docker container, wasting the limited EPC memory. The second one only launches one set of infrastructure enclaves for all SGX containers and we believe it is more efficient.</p>
<p>In our current solution, we put the AESM service process <code>aesmd</code> outside the Mesalock Linux docker container and only expose the domain socket <code>/var/run/aesm/aesm.socket</code> to the container. In this way, we isolate the AESM service along with the six foundation enclaves (Launch Enclave/Quoting Enclave/Provisioning Enclave/Provisioning Certification Enclave/Platform Service Enclave for long term pairing/Platform Service Enclave for session management) from Mesalock Linux docker container.</p>
<p><img decoding="async" loading="lazy" alt="overview" src="/assets/images/mesa-7fea936993b9706b89dec552daeedf6f.png" width="2667" height="1500" class="img__Ss2"></p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h2>
<p>Rust SGX SDK and docker</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="step-by-step-guide">Step-by-step Guide<a href="#step-by-step-guide" class="hash-link" aria-label="Direct link to Step-by-step Guide" title="Direct link to Step-by-step Guide">​</a></h2>
<p>Step 1 : build SGX application in Rust SGX dev docker container.</p>
<div class="language-bash codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-bash codeBlock_TAPP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">$ git pull git@github.com:apache/teaclave-sgx-sdk.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -v /path/to/rust-sgx-sdk:/root/sgx -ti --device /dev/isgx baiduxlab/sgx-rust</span><br></span></code></pre></div></div>
<p>In the Rust SGX dev docker container:</p>
<div class="language-bash codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-bash codeBlock_TAPP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /root/sgx/samplecode/hello-rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...(ignored many lines)...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/EnclaveConfiguration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcs_num 1, tcs_max_num 1, tcs_min_pool 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The required memory is 1732608B.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SIGN =&gt;  bin/enclave.signed.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ exit</span><br></span></code></pre></div></div>
<p>Now the <code>hello-rust</code> sample has been compiled successfully.</p>
<p>Step 2 : run SGX application in Mesalock Linux docker container</p>
<div class="language-bash codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-bash codeBlock_TAPP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run --rm -ti \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             --device /dev/isgx \                               # forward isgx device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             -v /path/to/rust-sgx-sdk:/root/sgx \               # add SDK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             -v /path/to/rust-sgx-sdk/mesalock-rt:/opt/sgxrt \  # add runtime lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             -v /var/run/aesmd:/var/run/aesmd \                 # forward domain socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             -e LD_LIBRARY_PATH=/opt/sgxrt \                    # set lib path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             -w /root/sgx/samplecode/hello-rust/bin \           # set working dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             mesalocklinux/mesalock-linux</span><br></span></code></pre></div></div>
<p>Now the Mesalock Linux docker container has been initiated using method (2) and an Ion shell has been launched. In the container, we execute:</p>
<div class="language-bash codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-bash codeBlock_TAPP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">:/root/sgx/samplecode/hello-rust/bin$ ./app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Home dir is /root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] Open token file /root/enclave.token error! Will create one.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Saved updated launch token!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Init Enclave Successful 2!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is a normal world string passed into Enclave!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is a in-Enclave Rust string!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] say_something success...</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="mesalock-rt-runtime-details">mesalock-rt Runtime Details<a href="#mesalock-rt-runtime-details" class="hash-link" aria-label="Direct link to mesalock-rt Runtime Details" title="Direct link to mesalock-rt Runtime Details">​</a></h2>
<p>All these runtime shared libraries come from official releases, including Intel SGX SDK v2.0 release and Ubuntu 16.04 package archive.</p>









































<table><thead><tr><th>File</th><th>Size</th><th>SHA256</th><th>Comes from</th></tr></thead><tbody><tr><td>libprotobuf.so.9</td><td>1170328</td><td>abd8b868f0f06584c30edbee90e27e2f8546ffe5bbe938922f62c5821b243925</td><td><a href="http://archive.ubuntu.com/ubuntu/pool/main/p/protobuf/libprotobuf9v5_2.6.1-1.3_amd64.deb" target="_blank" rel="noopener noreferrer">libprotobuf9v5_2.6.1-1.3_amd64.deb</a></td></tr><tr><td>libsgx_uae_service.so</td><td>359944</td><td>67de93140307268871eb0e00ade9fc800bf3f45371b68ac79157c71b454edbaa</td><td><a href="https://download.01.org/intel-sgx/linux-2.0/sgx_linux_ubuntu16.04.1_x64_psw_2.0.100.40950.bin" target="_blank" rel="noopener noreferrer">sgx_linux_ubuntu16.04.1_x64_psw_2.0.100.40950.bin</a></td></tr><tr><td>libsgx_urts.so</td><td>166376</td><td>05a15c27432bded48b49b98f94649b4e90abaedbb4ce8f3c44baa1ff5ce2493d</td><td><a href="https://download.01.org/intel-sgx/linux-2.0/sgx_linux_ubuntu16.04.1_x64_psw_2.0.100.40950.bin" target="_blank" rel="noopener noreferrer">sgx_linux_ubuntu16.04.1_x64_psw_2.0.100.40950.bin</a></td></tr><tr><td>libstdc++.so.6</td><td>1594800</td><td>5e68ec758e36fb2db90f6be673cf4112d144a2f29ba400cd5c6e0c8e56ad9408</td><td><a href="https://launchpad.net/~ubuntu-toolchain-r/+archive/ubuntu/test/+files/libstdc++6_7.2.0-1ubuntu1~16.04_amd64.deb" target="_blank" rel="noopener noreferrer">libstdc++6_7.2.0-1ubuntu1~16.04_amd64.deb</a></td></tr><tr><td>libz.so.1</td><td>104864</td><td>a04cab74df9c7f96f82b34286bda5d4ee810feaac92dd2e8bcfe931d9c8baef4</td><td><a href="http://us.archive.ubuntu.com/ubuntu/pool/main/z/zlib/zlib1g_1.2.11.dfsg-0ubuntu1_amd64.deb" target="_blank" rel="noopener noreferrer">zlib1g_1.2.11.dfsg-0ubuntu1_amd64.deb</a></td></tr></tbody></table></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/sgx-sdk-docs/environment-setup"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Setting up your Development Environment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/sgx-sdk-docs/is_x86_feature_detected-in-sgx-sdk"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">`is_x86_feature_detected` in Teaclave SGX SDK</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#is-it-safe-to-run-rust-sgx-applications-in-mesalock-linux" class="table-of-contents__link toc-highlight">Is it safe to run Rust SGX applications in Mesalock Linux?</a></li><li><a href="#solution-overview" class="table-of-contents__link toc-highlight">Solution Overview</a></li><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#step-by-step-guide" class="table-of-contents__link toc-highlight">Step-by-step Guide</a></li><li><a href="#mesalock-rt-runtime-details" class="table-of-contents__link toc-highlight">mesalock-rt Runtime Details</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><div style="font-size:.7rem; text-align:left;">Apache Teaclave (incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF. Copyright © 2020 The Apache Software Foundation. Licensed under the Apache License, Version 2.0. Apache Teaclave, Apache, the Apache feather, and the Apache Teaclave project logo are either trademarks or registered trademarks of the Apache Software Foundation.</div></div></div></div></footer></div>
</body>
</html>