<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-teaclave-sgx-sdk/documents/sgxtime" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Acquiring Trusted timestamp from Intel ME in SGX enclave | Apache Teaclave™ (incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://teaclave.apache.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://teaclave.apache.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://teaclave.apache.org/sgx-sdk-docs/sgxtime"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Acquiring Trusted timestamp from Intel ME in SGX enclave | Apache Teaclave™ (incubating)"><meta data-rh="true" name="description" content="Intel provides Trusted Platform Service via Intel Management Engine. Part of the Intel SGX features depend on the trusted platform service, including the trusted timestamp service. We implemented sgx_tservice:"><meta data-rh="true" property="og:description" content="Intel provides Trusted Platform Service via Intel Management Engine. Part of the Intel SGX features depend on the trusted platform service, including the trusted timestamp service. We implemented sgx_tservice:"><link data-rh="true" rel="canonical" href="https://teaclave.apache.org/sgx-sdk-docs/sgxtime"><link data-rh="true" rel="alternate" href="https://teaclave.apache.org/sgx-sdk-docs/sgxtime" hreflang="en"><link data-rh="true" rel="alternate" href="https://teaclave.apache.org/sgx-sdk-docs/sgxtime" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Acquiring Trusted Timestamp from Intel ME in SGX enclave","item":"https://teaclave.apache.org/sgx-sdk-docs/sgxtime"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Teaclave™ (incubating) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Teaclave™ (incubating) Atom Feed"><link rel="stylesheet" href="/assets/css/styles.e2b519a3.css">
<script src="/assets/js/runtime~main.b9db7108.js" defer="defer"></script>
<script src="/assets/js/main.d9920c39.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Apache Teaclave™" class="themedComponent_mlkZ themedComponent--light_NVdE" style="height:2.5rem;max-width:300px;padding-left:1.6rem;position:relative;top:0.1rem"><img src="/img/logo.svg" alt="Apache Teaclave™" class="themedComponent_mlkZ themedComponent--dark_xIcU" style="height:2.5rem;max-width:300px;padding-left:1.6rem;position:relative;top:0.1rem"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/powered-by">Powered By</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" file="community/community.md" href="/community">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" file="community/contributing.md" href="/contributing">Contributing</a></li><li><a class="dropdown__link" file="community/contributors.md" href="/contributors">Contributors</a></li><li><a class="dropdown__link" file="community/becoming-a-member.md" href="/becoming-a-member">Becoming a Member</a></li><li><a class="dropdown__link" file="community/maturity.md" href="/maturity">Maturity Assessment</a></li><li><a class="dropdown__link" file="community/release-guide.md" href="/release-guide">Release Guide</a></li></ul></div><a class="navbar__item navbar__link" href="/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" file="overview.md" href="/overview">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" file="teaclave-trustzone-sdk/docs/README.md" href="/trustzone-sdk-docs/">Teaclave TrustZone SDK</a></li><li><a href="https://teaclave.apache.org/api-docs/trustzone-sdk/optee_teec" target="_self" rel="" class="dropdown__link">API Docs: Teaclave TrustZone SDK (Host)<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://teaclave.apache.org/api-docs/trustzone-sdk/optee_utee" target="_self" rel="" class="dropdown__link">API Docs: Teaclave TrustZone SDK (TA)<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" file="teaclave-sgx-sdk/documents/README.md" href="/sgx-sdk-docs/">Teaclave SGX SDK</a></li><li><a href="https://teaclave.apache.org/api-docs/sgx-sdk/" target="_self" rel="" class="dropdown__link">API Docs: Teaclave SGX SDK<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a class="dropdown__link" file="teaclave-docs/README.md" href="/teaclave-docs/">Teaclave</a></li><li><a class="dropdown__link" file="teaclave-faas-legacy/docs/README.md" href="/docs/">Teaclave FaaS (legacy)</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Repos</a><ul class="dropdown__menu"><li><a href="https://github.com/apache/incubator-teaclave" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/apache/incubator-teaclave-sgx-sdk" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave SGX SDK<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/apache/incubator-teaclave-trustzone-sdk" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave TrustZone SDK<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/apache/incubator-teaclave-java-tee-sdk" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave Java TEE SDK<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/apache/incubator-teaclave-website" target="_blank" rel="noopener noreferrer" class="dropdown__link">Teaclave Website<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">ASF Homepage<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/sgx-sdk-docs/environment-setup">Development</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/environment-setup">Setting up your Development Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/sgx_in_mesalock_linux">Rust SGX Applications in Mesalock Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/is_x86_feature_detected-in-sgx-sdk">`is_x86_feature_detected` in Teaclave SGX SDK</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/developing-with-vscode">Developing with Visual Studio Code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/debugging-a-local-rust-sgx-enclave">Debugging a Local Enclave in Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/public-cloud-for-rust-sgx-dev">Public Cloud Rust SGX Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/the-world-of-forked-crates">The World of Forked Crates</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/sgx-sdk-docs/sgxtime">Tutorials</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/sgx-sdk-docs/sgxtime">Acquiring Trusted Timestamp from Intel ME in SGX enclave</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/sgx-sdk-docs/everything-about-cve-2020-5499">Security</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/everything-about-cve-2020-5499">Everything about CVE-2020-5499</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sgx-sdk-docs/mitigation-of-intel-sa-00219">Mitigation of Intel SA 00219 in Rust-SGX</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a href="https://www.ieee-security.org/TC/SP2019/posters/hotcrp_sp19posters-final11.pdf" target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true">Applications</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://www.ieee-security.org/TC/SP2019/posters/hotcrp_sp19posters-final11.pdf" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Fast and Trustworthy Gradient Boosting Decision Tree<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Acquiring Trusted Timestamp from Intel ME in SGX enclave</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Acquiring Trusted timestamp from Intel ME in SGX enclave</h1></header>
<p>Intel provides Trusted Platform Service via Intel Management Engine. Part of the Intel SGX features depend on the trusted platform service, including the trusted timestamp service. We implemented <code>sgx_tservice::SgxTime</code> for this feature. To use it in Linux, the prerequisites are:</p>
<ol>
<li><code>/dev/mei0</code> must exist.</li>
<li><a href="https://github.com/intel/dynamic-application-loader-host-interface" target="_blank" rel="noopener noreferrer">Dynamic Application Loader (DAL) Host Interface (aka JHI)</a> installed.</li>
<li><a href="https://software.intel.com/en-us/sgx-sdk/download" target="_blank" rel="noopener noreferrer">iclsClient</a> installed.</li>
</ol>
<p>The Ubuntu linux kernel would initiate Intel ME device during boot. Almost every Intel platform has Intel ME, but it may not be initiated properly. For <a href="https://github.com/ayeks/SGX-hardware/issues/24" target="_blank" rel="noopener noreferrer">example</a>, a server of SuperServer 5019S-MR with v2.0b BIOS + v4.0.3.96 SPS could be initiated properly, while the other server with the same mother board and same BIOS version but v4.1.3.22 SPS couldn&#x27;t.</p>
<p>The JHI service usually runs as a daemon service process. Its <a href="https://github.com/intel/dynamic-application-loader-host-interface/blob/master/readme.md" target="_blank" rel="noopener noreferrer">readme</a> is short and easy to read.</p>
<p>The iclsClient could be downloaded from the <a href="https://software.intel.com/en-us/sgx-sdk/download" target="_blank" rel="noopener noreferrer">Intel SGX&#x27;s website</a>. Tozd&#x27;s <a href="https://github.com/tozd/docker-sgx" target="_blank" rel="noopener noreferrer">docker-sgx</a> provides a sample Dockerfile including the setup of iclsClient.</p>
<p>One important thing is that the Intel SGX PSW has to be installed <strong>after</strong> the above three prerequisites has been satisfied. During the first time of PSW installation, the installer would try to do the provisioning for this platform, and this takes about one minute.</p>
<p>We provide <a href="/samplecode/sgxtime">sgxtime</a> code sample for demonstrating how to acquire trusted timestamp from Intel ME.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-in-docker">Run in docker<a href="#run-in-docker" class="hash-link" aria-label="Direct link to Run in docker" title="Direct link to Run in docker">​</a></h2>
<p>The dockerfile we provide contains an optional setup of icls. Due to the limitation of iclsClient, you need to acquire the installer from Intel and follow the instruction in <a href="/docker/Dockerfile">Dockerfile</a>.</p>
<p>After downloaded the icls installer, please uncomment the icls related lines in Dockerfile and build the docker image by yourself.</p>
<p>To run sgxtime in this docker image, first launch it using the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -ti -v /path/to/sdk:/root/sgx \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             --device /dev/isgx \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             --device /dev/mei0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             rust-sgx-docker    # This name is identified during docker build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~#</span><br></span></code></pre></div></div>
<p>Then start the <code>jhid</code> and <code>aesm_service</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~# jhid -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~# jhi[16]: --&gt; jhi start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jhi[16]: &lt;-- jhi start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~# /opt/intel/sgxpsw/aesm/aesm_service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~# aesm_service[18]: [ADMIN]White List update requested</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aesm_service[18]: The server sock is 0x55d3d2893940</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jhi[16]: JHI service release prints are enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jhi[16]: Applet repository dir path: /var/lib/intel/dal/applet_repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jhi[16]: Applets dir path: /var/lib/intel/dal/applets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aesm_service[18]: [ADMIN]White list update request successful for Version: 25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~#</span><br></span></code></pre></div></div>
<p>Then build the code sample</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~# cd sgx/samplecode/sgxtime/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~/sgx/samplecode/sgxtime# XARGO_SGX=1 make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -C ./enclave/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make[1]: Entering directory &#x27;/root/sgx/samplecode/sgxtime/enclave&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cargo build --release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Updating registry `https://github.com/rust-lang/crates.io-index`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.........</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/EnclaveConfiguration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcs_num 1, tcs_max_num 1, tcs_min_pool 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The required memory is 2437120B.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SIGN =&gt;  bin/enclave.signed.so</span><br></span></code></pre></div></div>
<p>Then run it. The first time would probably fail, but it only fails once.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~/sgx/samplecode/sgxtime/bin# ./app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Home dir is /root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] Open token file /root/enclave.token error! Will create one.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Saved updated launch token!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Init Enclave Successful 2!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aesm_service[18]: [ADMIN]Platform Services initializing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aesm_service[18]: [ADMIN]EPID Provisioning initiated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aesm_service[18]: [ADMIN]EPID Provisioning successful</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aesm_service[18]: PCH EPID RL retrieval failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cannot create PSE session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Err with SGX_ERROR_AE_SESSION_INVALID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">close PSE session done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] sgx_time_sample success...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~/sgx/samplecode/sgxtime/bin# ./app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Home dir is /root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Open token file success!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Token file valid!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Init Enclave Successful 2!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aesm_service[18]: [ADMIN]Platform Services initializing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aesm_service[18]: [ADMIN]Platform Services initialized successfully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Create PSE session done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok with SgxTime { timestamp: 1420259903, source_nonce: [17, 101, 46, 174, 115, 133, 196, 251, 170, 218, 3, 21, 81, 92, 144, 241, 66, 38, 230, 186, 251, 193, 41, 246, 148, 131, 111, 126, 191, 105, 17, 33] }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">close PSE session done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] sgx_time_sample success...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@913e6a00c8d8:~/sgx/samplecode/sgxtime/bin# ./app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Home dir is /root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Open token file success!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Token file valid!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Init Enclave Successful 2!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Create PSE session done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok with SgxTime { timestamp: 1420259905, source_nonce: [17, 101, 46, 174, 115, 133, 196, 251, 170, 218, 3, 21, 81, 92, 144, 241, 66, 38, 230, 186, 251, 193, 41, 246, 148, 131, 111, 126, 191, 105, 17, 33] }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">close PSE session done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] sgx_time_sample success...</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-without-docker">Run without docker<a href="#run-without-docker" class="hash-link" aria-label="Direct link to Run without docker" title="Direct link to Run without docker">​</a></h2>
<p>Follow the instruction of <a href="https://github.com/intel/dynamic-application-loader-host-interface" target="_blank" rel="noopener noreferrer">JHI</a> first. Be sure to run <code>systemctl enable jhi</code> to enable the service and then start it.</p>
<p>Install iclsClient following Intel&#x27;s setup <a href="https://download.01.org/intel-sgx/linux-2.0/docs/Intel_SGX_Installation_Guide_Linux_2.0_Open_Source.pdf" target="_blank" rel="noopener noreferrer">instruction</a>. <code>sudo ldconfig</code> may probably be needed after the installation.</p>
<p>Next, uninstall the current PSW (if installed) and reinstall it.</p>
<p>Now, <code>sgxtime</code> should work.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/sgx-sdk-docs/the-world-of-forked-crates"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">The World of Forked Crates</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/sgx-sdk-docs/everything-about-cve-2020-5499"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Everything about CVE-2020-5499</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#run-in-docker" class="table-of-contents__link toc-highlight">Run in docker</a></li><li><a href="#run-without-docker" class="table-of-contents__link toc-highlight">Run without docker</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><div style="font-size:.7rem; text-align:left;">Apache Teaclave™ (incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF. Copyright © 2020 The Apache Software Foundation. Licensed under the Apache License, Version 2.0. Apache Teaclave™, Apache, the Apache feather, and the Apache Teaclave™ project logo are either trademarks or registered trademarks of the Apache Software Foundation.</div></div></div></div></footer></div>
</body>
</html>