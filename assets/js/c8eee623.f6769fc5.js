"use strict";(self.webpackChunkapache_teaclave_incubating=self.webpackChunkapache_teaclave_incubating||[]).push([[2412],{6383:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"teaclave-faas-legacy/docs/build-system","title":"Build System","description":"The Teaclave\'s build system utilizes CMake to coordinate compilation, linking,","source":"@site/docs/teaclave-faas-legacy/docs/build-system.md","sourceDirName":"teaclave-faas-legacy/docs","slug":"/docs/build-system","permalink":"/docs/build-system","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"permalink":"/docs/build-system","slug":"/docs/build-system"},"sidebar":"teaclave-faas-legacy_sidebar","previous":{"title":"Access Control in Teaclave","permalink":"/docs/access-control"},"next":{"title":"Mutual Attestation: Why and How","permalink":"/docs/mutual-attestation"}}');var l=s(4848),c=s(8453);const t={permalink:"/docs/build-system",slug:"/docs/build-system"},d="Build System",r={},a=[{value:"Quick Start",id:"quick-start",level:2},{value:"Variables and Options",id:"variables-and-options",level:2},{value:"Variables",id:"variables",level:3},{value:"Options",id:"options",level:3},{value:"Targets",id:"targets",level:2},{value:"App/Enclave",id:"appenclave",level:3},{value:"Client SDK",id:"client-sdk",level:3},{value:"Bin",id:"bin",level:3},{value:"Linting",id:"linting",level:3},{value:"Doc",id:"doc",level:3},{value:"Tests",id:"tests",level:3},{value:"Misc",id:"misc",level:3},{value:"Codebase",id:"codebase",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"build-system",children:"Build System"})}),"\n",(0,l.jsx)(n.p,{children:"The Teaclave's build system utilizes CMake to coordinate compilation, linking,\nsigning, etc. for various components written in different languages (e.g., Rust, C,\nPython) for different targets (e.g., Linux and SGX). In this document, we will\nintroduce our build system in details."}),"\n",(0,l.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Download and ",(0,l.jsx)(n.a,{href:"https://cmake.org/install/",children:"install"})," CMake, the minimum\nrequired version is 3.10."]}),"\n",(0,l.jsx)(n.li,{children:"Open a shell and create a build directory."}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"$ mkdir build && cd build\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsxs)(n.li,{children:["Run the following command to configure with ",(0,l.jsx)(n.code,{children:"TEST_MODE"})," on."]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"$ cmake -DTEST_MODE=ON ..\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"4",children:["\n",(0,l.jsx)(n.li,{children:"Build the whole platform."}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"$ make\n"})}),"\n",(0,l.jsx)(n.p,{children:"When making changes, run:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"make format"}),": Format current source code."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"make run-tests"}),": Make sure all tests are passed."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"You can find more detailed configurations and targets in the following sections."}),"\n",(0,l.jsx)(n.h2,{id:"variables-and-options",children:"Variables and Options"}),"\n",(0,l.jsx)(n.p,{children:"There are a lot of variables and options you can configure to control the build\nsystem."}),"\n",(0,l.jsxs)(n.p,{children:["To set a variable or option, you can pass ",(0,l.jsx)(n.code,{children:"-DXXX="})," to ",(0,l.jsx)(n.code,{children:"cmake"}),". For example,\n",(0,l.jsx)(n.code,{children:"cmake -DTEST_MODE=ON .."})," to enable the ",(0,l.jsx)(n.code,{children:"TEST_MODE"})," option."]}),"\n",(0,l.jsx)(n.h3,{id:"variables",children:"Variables"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SGX_SDK"}),": Set (or get from env vars) the path of Intel SGX SDK. Defaults to\n",(0,l.jsx)(n.code,{children:"/opt/sgxsdk"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"RUSTFLAGS"}),": Set (or get from env vars) flags passed to rustc."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MESAPY_VERSION"}),": Set the commit hash to the upstream MesaPy version."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"RUSTUP_TOOLCHAIN"}),": Set the Rust toolchain version."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"CMAKE_BUILD_TYPE"}),": Set the build type. Defaults to debug."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"COV"}),": Build with coverage information. Defaults to OFF."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"OFFLINE"}),": Compile Rust code with ",(0,l.jsx)(n.code,{children:"cargo --offline"}),". Defaults to ON."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"TEST_MODE"}),": Build with mock data and disabling some functions for testing.\nDefaults to OFF."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SGX_SIM_MODE"}),": Build in SGX simulation mode. Defaults to OFF."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"DCAP"}),": Use DCAP instead of IAS as the attestation service. Defaults to OFF."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GIT_SUBMODULE"}),": Sync submodules with the upstream repositories. Defaults to\nON."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"CLP"}),": Enable ",(0,l.jsx)(n.code,{children:"cargo clippy"})," to lint Rust code during the compilation.\nDefaults to OFF."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"DOC"}),": Generate document with ",(0,l.jsx)(n.code,{children:"cargo doc"})," during the compilation. Defaults to OFF."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"USE_PREBUILT_MESAPY"}),": Whether to use the prebuilt MesaPy for SGX library. If\nset to OFF, will build the library from the source code. Defaults to ON."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"EXECUTOR_BUILTIN"}),": Compile with the Builtin executor. Defaults to ON."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"EXECUTOR_MESAPY"}),": Compile with the MesaPy executor. Defaults to ON."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"EXECUTOR_WAMR"}),": Compile with the WebAssembly Micro Runtime executor. Defaults to ON."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"targets",children:"Targets"}),"\n",(0,l.jsxs)(n.p,{children:["The followings are supported targets you can call with ",(0,l.jsx)(n.code,{children:"make"}),". For example, to build a specific\nservice like execution service, you can just run ",(0,l.jsx)(n.code,{children:"make teaclave_execution_service"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"appenclave",children:"App/Enclave"}),"\n",(0,l.jsx)(n.p,{children:"An SGX application has two parts: the app part and the enclave part. You can\ncompile them separately or together using with these targets:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"sgxapp-teaclave_{service_name}"}),": Build the app part of a service."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"sgxlib-teaclave_{service_name}"}),": Build the enclave part of a service."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"teaclave_{service_name}"}),": Build (compile, link and sign, etc.) the app and\nenclave of a service."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"sgxapp-teaclave_{test_name}"}),": Build the app part of a test driver."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"sgxlib-teaclave_{test_name}"}),": Build the enclave part of a test driver."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"teaclave_{test_name}"}),": Build (compile, link, and sign, etc.) the app and\nenclave of a test driver."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["These targets are automatically generated from the\n",(0,l.jsx)(n.code,{children:"cmake/tomls/Cargo.sgx_{}.toml"})," files. Basically, they are:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"test_name"})," can be: ",(0,l.jsx)(n.code,{children:"function_tests"}),", ",(0,l.jsx)(n.code,{children:"unit_tests"}),", ",(0,l.jsx)(n.code,{children:"integration_tests"}),", etc."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"service_name"})," can be: ",(0,l.jsx)(n.code,{children:"access_control_service"}),", ",(0,l.jsx)(n.code,{children:"authentication_service"}),",\n",(0,l.jsx)(n.code,{children:"storage_service"}),", ",(0,l.jsx)(n.code,{children:"execution_service"}),", ",(0,l.jsx)(n.code,{children:"frontend_service"}),",\n",(0,l.jsx)(n.code,{children:"management_service"}),", ",(0,l.jsx)(n.code,{children:"scheduler_service"}),", etc."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"client-sdk",children:"Client SDK"}),"\n",(0,l.jsx)(n.p,{children:"Build Teaclave client SDK and install the compiled dynamic/static libraries to\nthe release folder."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"teaclave_client_sdk"}),": Build the client SDK to both dynamic and static\nlibraries."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"bin",children:"Bin"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"teaclave_cli"}),": Build the Teclave command line tool."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"teaclave_dcap_ref_as"}),": Build the reference implementation of DCAP's\nattestation service."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"teaclave_sgx_tool"}),": Build the SGX tool."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Above targets are automatically generated from the\n",(0,l.jsx)(n.code,{children:"cmake/tomls/Cargo.unix_app.toml"})," files."]}),"\n",(0,l.jsx)(n.h3,{id:"linting",children:"Linting"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"format"}),": Format all code."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"clippy"}),": Run ",(0,l.jsx)(n.code,{children:"cargo clippy"})," for linting. Same with ",(0,l.jsx)(n.code,{children:"make CLP=1"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"doc",children:"Doc"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"doc"}),": Run ",(0,l.jsx)(n.code,{children:"cargo doc"})," to generate documents. Same with ",(0,l.jsx)(n.code,{children:"make DOC=1"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"tests",children:"Tests"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"run-tests"}),": Run all test cases."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"run-integration-tests"}),": Run integration tests only."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"run-funtional-tests"}),": Run functional tests only."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"run-sdk-tests"}),": Run tests of client SDK only."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"run-examples"}),": Run all examples."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"cov"}),": Aggregate coverage results and generate report, needs to config cmake\nwith ",(0,l.jsx)(n.code,{children:"-DCOV=ON"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"misc",children:"Misc"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"clean"}),": Cleanup all building intermediates."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"codebase",children:"Codebase"}),"\n",(0,l.jsxs)(n.p,{children:["You can find source code to learn more about our build system in the\n",(0,l.jsx)(n.code,{children:"CMakeLists.txt"})," file and the ",(0,l.jsx)(n.code,{children:"cmake"})," directories."]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>d});var i=s(6540);const l={},c=i.createContext(l);function t(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);